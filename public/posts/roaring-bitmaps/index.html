<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Roaring Bitmaps | My New Hugo Site</title>
<meta name="keywords" content="">
<meta name="description" content="Travel
Suppose you want to travel from Seattle to New York City. You would (obviously) fly, because walking across the country would be insane. But if you want to go from your apartment in Capitol Hill to Pike Place Market in downtown, you&rsquo;d probably take a bus and then walk a bit, because calling an Uber to the airport to catch a cross-country flight to go two miles would be, well, equally insane but in the opposite direction.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/roaring-bitmaps/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/roaring-bitmaps/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="My New Hugo Site (Alt + H)">My New Hugo Site</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Roaring Bitmaps
    </h1>
    <div class="post-meta"><span title='2025-12-28 01:02:11 -0800 PST'>December 28, 2025</span>

</div>
  </header> 
  <div class="post-content"><h2 id="travel">Travel<a hidden class="anchor" aria-hidden="true" href="#travel">#</a></h2>
<p>Suppose you want to travel from Seattle to New York City. You would (obviously) fly, because walking across the country would be insane. But if you want to go from your apartment in Capitol Hill to Pike Place Market in downtown, you&rsquo;d probably take a bus and then walk a bit, because calling an Uber to the airport to catch a cross-country flight to go two miles would be, well, equally insane but in the opposite direction.</p>
<table style="margin: 0 auto; border: none;">
  <tr style="border: none;">
    <td style="border: none; padding: 10px; text-align: center;">
      <img src="sea2nyc.png" alt="Seattle to NYC" style="max-width: 400px; width: 100%; height: 300px; object-fit: contain;">
    </td>
  </tr>
</table>
<p>The best way to get somewhere depends on the <em>distance</em> you&rsquo;re traveling. Nobody uses the same transportation method for every trip. You look at each leg of your journey and pick the method that makes sense for that particular stretch.</p>
<h2 id="bitmap">Bitmap<a hidden class="anchor" aria-hidden="true" href="#bitmap">#</a></h2>
<p>Now suppose you are a newsletter writer with 10 subscribers, and you want to write a program to keep track of how many of those subscribers are paid subscriber. One way to do it is by using a bitmap/ bitset, where you create an array of bits of size 10, and each position (bit) corresponds to a subscriber, and the bit is <code>1</code> if the subscriber is a paid subscriber and <code>0</code> if not. For example, label your subscribers from 0 to 9. If subscribers #1, #4, #6 and #7 are paid, you&rsquo;d set those bit positions to 1 and leave the rest 0:</p>
<p><code>[0, 1, 0, 0, 1, 0, 1, 1, 0, 0]</code></p>
<p>Another way to do it is by creating an array of only paid subscribers, where the array stores the IDs of subscribers who are paid. For example, if subscribers #4, and #7 are paid, you&rsquo;d store <code>[4, 7]</code>. The upside is that when only a small fraction of subscribers are paid, this representation is <strong>more space-efficient</strong> since you only store the paid ones, not 10 slots. The downside is that checking whether subscriber #5 is paid means searching the array (unless you keep it sorted and use binary search).</p>
<p>Now you become a very successful writer with 1 billion subscribers and almost all of your old subscribers are paid subscribers.</p>
<p>The bitmap and the array approach would require 1 billion bits (about 125 MB) and around 1 billion INT (about 4 GB for 32bit INT) - manageable, but large. The sparse array approach would be terrible here because if 999 million out of 1 billion subscribers are paid, you&rsquo;d need to store 999 million IDs! This is where <strong>Run-Length Encoding (RLE)</strong> shines. Instead of storing each bit individually, RLE compresses sequences by storing the <em>length</em> of consecutive runs of the same value. For example, if you have this bitmap:</p>
<p><code>[1, 1, 1, 1, 1, 0, 1, 1, 1, 1] </code></p>
<p>RLE would encode it as:</p>
<p><code>[(1, 5), (0, 1), (1, 4)]</code></p>
<p>which means: &ldquo;five 1s, then one 0, then four 1s&rdquo;</p>
<p>With 1 billion subscribers where almost everyone is paid, you might have:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[1, 1, 1, ..., 1, 0, 1, 1, ..., 1, 0, 0, 1, 1, ..., 1]
</span></span><span class="line"><span class="cl">└─  500M 1s  ─┘      └─ 499M 1s ─┘ └─   rest       ─┘
</span></span></code></pre></td></tr></table>
</div>
</div><p>RLE could compress this to just a few entries:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[(1, 500000000), (0, 1), (1, 499000000), (0, 2), (1, 999997)]
</span></span></code></pre></td></tr></table>
</div>
</div><p>Instead of storing 1 billion bits, you only store a handful of (value, length) pairs! This is extremely space-efficient when you have long runs of the same value</p>
<p>So far so good, but real life is messier than this.</p>
<p>Suppose you have 1 billion subscribers but they signed up over time. Your first 100 million subscribers are superfans - almost all of them are paid (dense data, RLE is perfect). Then you went viral on Twitter and got 400 million drive-by subscribers, and only 1% of them converted to paid (super sparse data, array is perfect). Then your most recent 500 million subscribers have about 50% conversion (medium density, bitmap is perfect).</p>
<p>If you use <em>just</em> RLE for everything, you&rsquo;re compressing &ldquo;1, 0, 1, 0, 1, 0&hellip;&rdquo; in that middle chunk, which is terrible - RLE loves long runs, not alternating bits. If you use <em>just</em> arrays for everything, you&rsquo;re storing 549 million IDs when you could&rsquo;ve compressed most of them. If you use <em>just</em> bitmaps for everything, you&rsquo;re using 125 MB when you could do much better.</p>
<img src="before.png" alt="before" style="max-width: 300px; width: 100%; height:auto;">
<p>Similar to our traveling example, the best way to store your data depends on the <em>density</em> of your subscribers. Nobody uses the same storage method for every chunk of data. You look at each segment of your subscriber base and pick the method that makes sense for that particular chunk.</p>
<img src="after.png" alt="after" style="max-width: 300px; width: 100%; height:auto;">
<p>Well this is basically how Roaring Bitmaps store data.</p>
<h2 id="what-is-roaring-bitmaps">What is Roaring Bitmaps<a hidden class="anchor" aria-hidden="true" href="#what-is-roaring-bitmaps">#</a></h2>
<p>Roaring Bitmaps use a two-level system - think of it like a filing cabinet.</p>
<p>On a high level, Roaring Bitmaps divide your data (we&rsquo;ll use 32-bit integers)
into Containers (chunks) and then look at each container and update it to the
most appropriate storage option as data gets updated.</p>
<h3 id="level-1-the-directory--how-does-it-divide-data">Level 1: The &ldquo;Directory&rdquo; / How does it divide data<a hidden class="anchor" aria-hidden="true" href="#level-1-the-directory--how-does-it-divide-data">#</a></h3>
<p>Roaring Bitmaps split every 32-bit integer into two 16-bit parts:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">32-bit integer:  [High 16 bits]      [Low 16 bits]
</span></span><span class="line"><span class="cl">                      ↓                   ↓
</span></span><span class="line"><span class="cl">                    &#34;Key&#34;             Stored in
</span></span><span class="line"><span class="cl">               (to index Containers)   Container
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>High 16 bits:</strong> Stored as a key to index Containers</li>
<li><strong>Low 16 bits:</strong> Stored in the corresponding Container.</li>
</ul>
<p>The high 16 bits divide the integer space [0, 2^32) into chunks of <strong>65,536</strong> (2^16) consecutive integers.</p>
<ul>
<li><strong>Container 0:</strong> [0, 65536) → key = 0</li>
<li><strong>Container 1:</strong> [65536, 131072) → key = 1</li>
<li><strong>&hellip;</strong></li>
</ul>
<img src="hierarchy.jpg" alt="Seattle to NYC" style="max-width: 600px; width: 100%; height:" style="max-width: 400px; width: 100%; height:auto;">
<p><strong>Example:</strong> Let&rsquo;s say you want to store the integer <strong>70,000</strong>.</p>
<ul>
<li><strong>In binary:</strong> 70,000 = <code>0000 0000 0000 0001 0001 0001 0111 0000</code></li>
<li><strong>High 16 bits:</strong> <code>0000 0000 0000 0001</code> = <strong>1</strong> → This is the container key</li>
<li><strong>Low 16 bits:</strong> <code>0001 0001 0111 0000</code> = <strong>4,464</strong> → This is what gets stored</li>
</ul>
<p>So the integer 70,000 gets routed to <strong>Container 1</strong> (because its high bits equal 1),
and the value <strong>4,464</strong> is stored inside that container.</p>
<h3 id="level-2-the-data-storage--how-does-it-store-data">Level 2: The &ldquo;Data Storage&rdquo; / how does it store data<a hidden class="anchor" aria-hidden="true" href="#level-2-the-data-storage--how-does-it-store-data">#</a></h3>
<p>Each container stores up to 65,536 values (the low 16 bits). Roaring Bitmaps dynamically switch between three container types based on data density to optimize memory.</p>
<table>
  <thead>
      <tr>
          <th><strong>Container Type</strong></th>
          <th><strong>Optimized For</strong></th>
          <th><strong>Threshold / Logic</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>ArrayContainer</strong></td>
          <td><strong>Sparse Data</strong><br>(Cardinality ≤ 4096)</td>
          <td>Uses <strong>binary search</strong> for lookups. Extremely compact for few elements (e.g., 4 items = 8 bytes).</td>
      </tr>
      <tr>
          <td><strong>BitmapContainer</strong></td>
          <td><strong>Dense Data</strong><br>(Cardinality &gt; 4096)</td>
          <td>Fixed size of <strong>8KB</strong>. Supports fast bitwise operations (AND/OR/XOR).</td>
      </tr>
      <tr>
          <td><strong>RunContainer</strong></td>
          <td><strong>Sequential Data</strong><br>(Long runs of numbers)</td>
          <td>Run-Length Encoded (RLE). Example: <code>{10, 11, 12, 13}</code> becomes <code>(10, 3)</code>. Created only via <code>runOptimize()</code>.</td>
      </tr>
  </tbody>
</table>
<h3 id="how-to-add-a-value">How to add a value<a hidden class="anchor" aria-hidden="true" href="#how-to-add-a-value">#</a></h3>
<p>When you add a value, the system routes the data to the correct container or creates a new one.</p>
<p>Let&rsquo;s look at the <a href="https://github.com/lemire/RoaringBitmap/blob/b2580c61dea3e3f102a26b70ff3fa6065eabc448/RoaringBitmap/src/main/java/org/roaringbitmap/RoaringBitmap.java#L1061-L1071">official Java implementation</a> to see this routing logic in action</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">public void add(final int x) {
</span></span><span class="line"><span class="cl">    final short hb = Util.highbits(x);        // 1. Extract high 16 bits
</span></span><span class="line"><span class="cl">    final int i = highLowContainer.getIndex(hb); // 2. Binary search for key
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    if (i &gt;= 0) {
</span></span><span class="line"><span class="cl">        // 3. Container exists - add low bits to it
</span></span><span class="line"><span class="cl">        highLowContainer.setContainerAtIndex(i,
</span></span><span class="line"><span class="cl">            highLowContainer.getContainerAtIndex(i).add(Util.lowbits(x)));
</span></span><span class="line"><span class="cl">            //3.5 Will auto convert to a different container if threshold is met
</span></span><span class="line"><span class="cl">    } else {
</span></span><span class="line"><span class="cl">        // 4. No container - create new ArrayContainer
</span></span><span class="line"><span class="cl">        final ArrayContainer newac = new ArrayContainer();
</span></span><span class="line"><span class="cl">        highLowContainer.insertNewKeyValueAt(-i - 1, hb, newac.add(Util.lowbits(x)));
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Auto-Conversion Logic:</strong></p>
<ul>
<li><strong>Array → Bitmap:</strong> If an <code>ArrayContainer</code> exceeds 4096 elements, it converts to a <code>BitmapContainer</code>.</li>
<li><strong>Bitmap → Array:</strong> If elements are removed and cardinality drops, it converts back to save memory.</li>
<li><strong>→ RunContainer:</strong> Only occurs if explicitly requested via <code>runOptimize()</code> or during specific range operations.</li>
</ul>
<p>Here is the <a href="https://github.com/lemire/RoaringBitmap/blob/b2580c61dea3e3f102a26b70ff3fa6065eabc448/RoaringBitmap/src/main/java/org/roaringbitmap/ArrayContainer.java#L123-L125">Java example</a> of the Array to Bitmap conversion</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">  <span class="err">@</span><span class="n">Override</span>
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="ne">Container</span> <span class="n">add</span><span class="p">(</span><span class="ne">int</span> <span class="n">begin</span><span class="p">,</span> <span class="ne">int</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">newcardinality</span> <span class="o">&gt;</span> <span class="n">DEFAULT_MAX_SIZE</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">BitmapContainer</span> <span class="n">a</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">toBitmapContainer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">iadd</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">@</span><span class="n">Override</span>
</span></span><span class="line"><span class="cl">  <span class="n">public</span> <span class="n">BitmapContainer</span> <span class="n">toBitmapContainer</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">BitmapContainer</span> <span class="n">bc</span> <span class="o">=</span> <span class="n">new</span> <span class="n">BitmapContainer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">bc</span><span class="o">.</span><span class="n">loadData</span><span class="p">(</span><span class="n">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">bc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>There are other operations (set operation/ iteration/ aggregation) and other optimization (lazy operation /hybrid binary search/ SIMD) that I am not going to discuss here.</p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>In this blog we discussed the basics of Roaring Bitmaps.
I first came across Roaring Bitmaps when I read about the <a href="https://opensource.googleblog.com/2025/08/whats-new-in-iceberg-v3.html">Apache Iceberg v3 updates</a>
I found the general technique behind Roaring Bitmaps where you</p>
<ul>
<li>Partition by local homogeneity</li>
<li>Apply best-fit technique per partition</li>
<li>Maintain composability (operate on parts independently)
to be really useful.</li>
</ul>
<p>This allows you to avoid worst-case performance and exploit local specialization for speed/space/accuracy.</p>
<p>Just as you wouldn&rsquo;t take a plane to the grocery store, you shouldn&rsquo;t use a single data structure for every dataset. Partitioning your data allows you to walk when it&rsquo;s close and fly when it&rsquo;s far, giving you the best of both worlds. If you are interested in learning more, checkout <a href="https://roaringbitmap.org/">https://roaringbitmap.org/</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">My New Hugo Site</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
